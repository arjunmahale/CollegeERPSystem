<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Faculty Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script th:inline="javascript">
  window.onload = function() {
    // update table numbering & count
    updateSrNo();

    // check if a student was saved and mark it

  };
</script>


  <style>
    .summary-cards {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      justify-content: space-around;
    }
    .card {
      flex: 1;
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
      border-radius: 10px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    }
    .card h2 {
      margin: 10px 0;
      font-size: 24px;
      color: #007bff;
    }
    .data-section {
      margin: 20px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
<header><u>Attendance</u></header>
<div class="container">
  <nav class="sidebar" >
  <div class="profile" style="text-align: center; margin-bottom: 20px;">
    <img src="profile.jpg" alt="Admin Profile" class="profile-pic" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 10px;">
    <h3 class="profile-name" th:text="${user}" style="font-size: 16px; margin: 0;"></h3>
  </div>

  <a href="/faculty-dashboard" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-home" style="margin-right: 10px;"></i> Faculty Dashboard
  </a>

  <a href="/student-list" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-user-graduate" style="margin-right: 10px;"></i> Student Enrolled
  </a>

  <a href="/attendance" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-check-square" style="margin-right: 10px;"></i> Attendance
  </a>

  <a href="/exams" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-file-alt" style="margin-right: 10px;"></i> Exams & Results
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-bell" style="margin-right: 10px;"></i> Notifications / Notice Board
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-calendar-alt" style="margin-right: 10px;"></i> Timetable
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-file-invoice" style="margin-right: 10px;"></i> Reports
  </a>
</nav>



  <main class="main" id="main-content">


 <h1 style="display:flex; justify-content:center; align-items:center;">
Attendance Report
</h1>


<!-- ‚úÖ Search Bar -->
<div style="margin-bottom: 15px; display:flex; gap:10px; margin-top: 30px">
  <input type="text" id="searchInput" placeholder="Enter Student ID"
         style="padding:8px;border:1px solid #ccc;border-radius:5px;flex:1;">
  <button onclick="searchStudent()"
          style="padding:8px 15px;background-color:#007bff;color:white;border:none;border-radius:5px;">
    Search
  </button>
  <button onclick="resetTable()"
          style="padding:8px 15px;background-color:#6c757d;color:white;border:none;border-radius:5px;">
    Refresh
  </button>

</div>

<!-- ‚úÖ Print & Sort Controls -->
<div style="margin-bottom: 15px; text-align:right; display:flex; justify-content:flex-end; gap:10px;">
  <select id="sortDropdown" onchange="applySort()"
          style="padding:8px;border:1px solid #ccc;border-radius:5px;">
    <option value="id">Sort by ID</option>
    <option value="name">Sort by Name</option>
    <option value="roll">Sort by Roll No</option>
  </select>
  <button onclick="printTable()"
          style="padding:8px 15px;background-color:#17a2b8;color:white;border:none;border-radius:5px;">
    üñ®Ô∏è Print Attendance
  </button>
   <!-- ‚úÖ Added Export to excel Button -->
        <button onclick="exportToExcel()"
                style="padding:8px 15px;background-color:#28a745;color:white;border:none;border-radius:5px;">
          ‚¨áÔ∏è Download as Excel
        </button>
</div>

<!-- ‚úÖ Student Count -->
<div style="margin-bottom: 10px; text-align:left;">
  <strong id="studentCount">Total Students: 0</strong>
</div>
<!-- üìÖ Date Selector -->
<div style="margin:15px 0; display:flex; justify-content:space-between; align-items:center;">
  <div>
    <strong>Date: </strong>
    <span th:text="${today}"></span>
  </div>



  <!-- ‚úÖ Extra button to view all previous attendance
  <form action="/attendance/all" method="get">
    <button type="submit"
            style="padding:8px 12px; background:#6c757d; color:white; border:none; border-radius:5px;">
      üìÖ View All Previous Attendance
    </button>
  </form>

 -->
 </div>



<!-- ‚úÖ Attendance Table -->
<!-- ‚úÖ Attendance Table -->
<table class="student-table" border="1" cellspacing="0" cellpadding="8"
       style="width:100%; border-collapse: collapse; text-align:center;">
  <thead>
  <tr>
    <th>Sr. No.</th>
    <th>ID</th>
    <th>Name</th>
    <th>Roll No.</th>
 <!--   <th>Action</th> ‚úÖ New column -->
    <th>Status</th>
  </tr>
</thead>
<tbody id="studentTableBody">
  <tr th:each="student, iterStat : ${students}"
      th:attr="data-student-id=${student.id}">
    <td th:text="${iterStat.count}"></td>
    <td th:text="${student.id}"></td>
    <td th:text="${student.name}"></td>
    <td th:text="${student.roll_no}"></td>
      <!-- ‚úÖ Present <td>

      <form th:action="@{/attendance/save}" method="post" style="display:inline;">
        <input type="hidden" name="studentId" th:value="${student.id}">
        <input type="hidden" name="date" th:value="${today}">
        <input type="hidden" name="name" th:value="${student.name}">
        <input type="hidden" name="course" th:value="${student.course.name}">
        <input type="hidden" name="status" value="Present">
        <button type="submit"
                style="padding:5px 10px; border:none; border-radius:5px; background:green; color:white; cursor:pointer;">
          Present
        </button>
      </form>-->

      <!-- ‚úÖ Absent
      <form th:action="@{/attendance/save}" method="post" style="display:inline;">
        <input type="hidden" name="studentId" th:value="${student.id}">
        <input type="hidden" name="date" th:value="${today}">
                <input type="hidden" name="name" th:value="${student.name}">
        <input type="hidden" name="course" th:value="${student.course}">

        <input type="hidden" name="status" value="Absent">
        <button type="submit"
                style="padding:5px 10px; border:none; border-radius:5px; background:red; color:white; cursor:pointer;">
          Absent
        </button>
      </form>
    </td>-->
    <!-- ‚úÖ Status Column -->
  <td class="status-cell"
    th:text="${attendanceMap[student.id] != null ? attendanceMap[student.id] : 'Not Marked'}"
    th:style="${attendanceMap[student.id] == 'Present' ? 'color:green;font-weight:bold;'
               : (attendanceMap[student.id] == 'Absent' ? 'color:red;font-weight:bold;' : '')}">
</td>

  </tr>
</tbody>

</table>


<!-- ‚úÖ JS Logic -->
<script>
  // Add Sr. No. dynamically
  function updateSrNo() {
    const rows = document.querySelectorAll("#studentTableBody tr");
    let visibleCount = 0;
    rows.forEach(row => {
      if (row.style.display !== "none") {
        visibleCount++;
        row.querySelector("td:first-child").textContent = visibleCount;
      }
    });
    document.getElementById("studentCount").innerText = "Total Students: " + visibleCount;
  }

  // üîç Search
  function searchStudent() {
    const input = document.getElementById("searchInput").value.trim();
    const rows = document.querySelectorAll("#studentTableBody tr");

    rows.forEach(row => {
      const idCell = row.children[1].textContent.trim();
      if (input === "" || idCell === input) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
    updateSrNo();
  }

  function resetTable() {
    document.getElementById("searchInput").value = "";
    const rows = document.querySelectorAll("#studentTableBody tr");
    rows.forEach(row => row.style.display = "");
    updateSrNo();
  }

  // üìä Sorting
  function applySort() {
    const sortBy = document.getElementById("sortDropdown").value;
    const tbody = document.getElementById("studentTableBody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    const colIndexMap = {
      id: 1,
      name: 2,
      roll: 3
    };

    const colIndex = colIndexMap[sortBy];

    rows.sort((a, b) => {
      let valA = a.children[colIndex].textContent.trim();
      let valB = b.children[colIndex].textContent.trim();

      if (!isNaN(valA) && !isNaN(valB)) {
        valA = Number(valA);
        valB = Number(valB);
      }

      if (valA < valB) return -1;
      if (valA > valB) return 1;
      return 0;
    });

    tbody.innerHTML = "";
    rows.forEach(row => tbody.appendChild(row));
    updateSrNo();
  }

  // üñ®Ô∏è Print
  function printTable() {
    const table = document.querySelector(".student-table").outerHTML;
    const newWin = window.open("", "", "width=800,height=600");
    newWin.document.write(`
      <html>
        <head>
          <title>Attendance List</title>
          <style>
            table { width:100%; border-collapse: collapse; text-align:center; }
            th, td { border:1px solid #333; padding:8px; }
            th { background-color:#f2f2f2; }
            h2 { text-align:center; }
          </style>
        </head>
        <body>
          <h2>Attendance List</h2>
          ${table}
        </body>
      </html>
    `);
    newWin.document.close();
    newWin.print();
  }

  // ‚úÖ On page load update Sr. No. + student count (natural order)

  // ‚úÖ Export to Excel
function exportToExcel() {
  const table = document.querySelector(".student-table");
  let html = table.outerHTML;

  // Excel needs a special MIME type
  let uri = 'data:application/vnd.ms-excel;charset=utf-8,' + encodeURIComponent(html);

  let fileDownload = document.createElement("a");
  document.body.appendChild(fileDownload);
  fileDownload.href = uri;
  fileDownload.download = 'total-attendance-list.xls';  // üìÇ Excel file
  fileDownload.click();
  document.body.removeChild(fileDownload);
}

</script>


  </main>
</div>

<footer>
  <div class="footer-container">
    <div class="footer-section">
      <h4>College ERP System</h4>
      <p>&copy; 2025 All Rights Reserved</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="/student-management">Student Management</a></li>

        <li><a href="/attendence">Attendance</a></li>
        <li><a href="/reports">Reports</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Contact</h4>
      <p>Email: support@collegeerp.com</p>
      <p>Phone: +91-9876543210</p>
    </div>
  </div>
</footer>
</body>
</html>
