<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- hidden containers that contain raw HTML message (th:utext so <b> remains) -->
<div id="flashSuccess" th:if="${message}" th:utext="${message}" style="display:none;"></div>
<div id="flashError" th:if="${error}" th:utext="${error}" style="display:none;"></div>

<!-- show SweetAlert popups by reading innerHTML from hidden divs -->
<script>
  // show error if any
  (function() {
    var errDiv = document.getElementById('flashError');
    if (errDiv) {
      var html = errDiv.innerHTML || '';
      Swal.fire({
        icon: 'error',
        title: 'Error',
        html: html,   // accepts HTML
        confirmButtonText: 'OK'
      });
    }

    var successDiv = document.getElementById('flashSuccess');
    if (successDiv) {
      var html2 = successDiv.innerHTML || '';
      Swal.fire({
        icon: 'success',
        title: 'Success',
        html: html2,
        confirmButtonText: 'OK'
      });
    }
  })();
</script>

  <style>
    .summary-cards {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      justify-content: space-around;
    }
    .card {
      flex: 1;
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
      border-radius: 10px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    }
    .card h2 {
      margin: 10px 0;
      font-size: 24px;
      color: #007bff;
    }
    .data-section {
      margin: 20px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .profile-container {
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 12px;
      box-shadow: 0px 3px 8px rgba(0,0,0,0.15);
    }
    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .profile-header img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #007bff;
    }
    .profile-header h2 {
      margin: 10px 0 5px 0;
      color: #007bff;
    }
    .profile-header p {
      font-size: 14px;
      color: #666;
    }
    .profile-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .detail-card {
      background: transparent;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .detail-card h4 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }
    .detail-card p {
      margin: 0;
      font-size: 14px;
      color: #555;
    }



  .live-badge-wrapper { display:flex; justify-content:center; }
  .live-heading {
    display:flex;
    align-items:center;
    gap:12px;
    font-family: Arial, Helvetica, sans-serif;
    font-size:22px;
    color:#222;
    margin:0;
    padding:6px 12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
    border-radius:10px;

  }

  /* pulsing dot */
  .live-dot {
    width:14px;
    height:14px;
    border-radius:50%;
    background:#e53935;
    position: relative;
    box-shadow: 0 0 0 rgba(229,57,53,0.8);
    animation: pulse 0.9s ease-out infinite, blink 1.2s linear infinite;
  }

  /* expanding faint ring */
  .live-dot::after{
    content:'';
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:14px;
    height:14px;
    border-radius:50%;
    background: transparent;
    box-shadow: 0 0 0 rgba(229,57,53,0.25);
    animation: ring 1.8s ease-out infinite;
    pointer-events:none;
  }

  .live-text {
    font-weight:700;
    letter-spacing:0.2px;
    color:#111;
    display:inline-block;
    transform-origin:center;

  }

  /* keyframes */
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(229,57,53,0.9); }
    70% { box-shadow: 0 0 0 10px rgba(229,57,53,0); }
    100% { box-shadow: 0 0 0 0 rgba(229,57,53,0); }
  }
  @keyframes ring {
    0% { transform: translate(-50%,-50%) scale(1); opacity: 0.7; }
    70% { transform: translate(-50%,-50%) scale(2.2); opacity: 0; }
    100% { transform: translate(-50%,-50%) scale(1); opacity: 0; }
  }
  @keyframes blink {
    0%, 60% { opacity: 1; }
    61%, 100% { opacity: 0.85; }
  }
  @keyframes subtlePop {
    0% { transform: translateY(0); }
    50% { transform: translateY(-2px); }
    100% { transform: translateY(0); }
  }

  /* small-screen tweak */
  @media (max-width:480px){
    .live-heading { font-size:18px; gap:8px; padding:8px; }
    .live-dot { width:12px; height:12px; }
  }

  </style>
</head>
<body>

<header><u>Student Dashboard</u></header>
<div class="container">
   <nav class="sidebar" >
  <div class="profile" style="text-align: center; margin-bottom: 20px;">
    <img src="profile.jpg" alt="Admin Profile" class="profile-pic" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 10px;">
    <h3 class="profile-name" th:text="${user}" style="font-size: 16px; margin: 0;"></h3>
  </div>

  <a href="/student-dashboard" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-home" style="margin-right: 10px;"></i> Student Dashboard
  </a>

  <a href="/student-attendance" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-check-square" style="margin-right: 10px;"></i> Attendance
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-clipboard-list" style="margin-right: 10px;"></i> Marks
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-file-alt" style="margin-right: 10px;"></i> Exams & Results
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-bell" style="margin-right: 10px;"></i> Notifications / Notice Board
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-calendar-alt" style="margin-right: 10px;"></i> Timetable
  </a>

  <a href="#" style="display: block; padding: 10px; color: #ecf0f1; text-decoration: none; font-size: 14px; margin-bottom: 5px;">
    <i class="fas fa-file-invoice" style="margin-right: 10px;"></i> Reports
  </a>
</nav>

  <main class="main" id="main-content">
   <div style="margin-top: 5px">
    <strong>Date: </strong>
    <span th:text="${today}"></span>
  </div>

<div style="display:flex; justify-content:center; align-items:flex-start; padding-top:40px; background: transparent; min-height:100vh;">
  <div style="background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; width:50%;">

 <!-- Put this where you want the live header -->
<div class="live-badge-wrapper" role="status" aria-live="polite">
  <h1 class="live-heading">
    <span class="live-dot" aria-hidden="true" th:if="${canMark}"></span>
    <span class="live-text" th:if="${canMark}" >Attendance is Live</span>
    <span class="live-text" th:if="${!canMark}"  >Attendance </span>
  </h1>
</div>



    <div style="margin:15px 0; font-size:15px; color:#555;">
      <p><strong>Date:</strong> <span th:text="${today}"></span></p>
      <p><strong>Student:</strong> <span th:text="${student.name}"></span></p>
    </div>

    <div th:if="${canMark}">
 <!-- Mark Present -->
<form th:action="@{/attendance/save}" method="post" style="display:inline;">
  <input type="hidden" name="studentId" th:value="${student.id}">
  <input type="hidden" name="date" th:value="${today}">
  <input type="hidden" name="name" th:value="${student.name}">
  <input type="hidden" name="course" th:value="${student.course.name}">
  <input type="hidden" name="status" value="Present">

  <button type="submit"
          style="
            padding:10px 20px;
            border:none;
            border-radius:6px;
            background:linear-gradient(45deg,#4caf50,#2e7d32);
            color:white;
            font-size:14px;
            font-weight:600;
            cursor:pointer;
            transition:all 0.3s ease;
            box-shadow:0 3px 6px rgba(0,0,0,0.15);
            margin-right:12px;
          "
          onmouseover="this.style.opacity=0.9"
          onmouseout="this.style.opacity=1">
    Mark as Present
  </button>
</form>


<!-- Absent With Reason (toggle input & hide button) -->
<button type="button"
        id="absentBtn"
        onclick="showReasonBox();"
        style="
          padding:10px 20px;
          border:none;
          border-radius:6px;
          background:linear-gradient(45deg,#ff9800,#ff5722);
          color:white;
          font-size:14px;
          font-weight:600;
          cursor:pointer;
          margin-top:12px;
          transition:all 0.3s ease;
          box-shadow:0 3px 6px rgba(0,0,0,0.15);
        "
        onmouseover="this.style.opacity=0.9"
        onmouseout="this.style.opacity=1">
  Absent With Reason
</button>

<!-- Hidden form for reason -->
<form id="reason-box" th:action="@{/attendance/save}" method="post"
      style="display:none; margin-top:20px; padding:18px; border:1px solid #ddd; border-radius:8px; background:#fafafa; box-shadow:0 3px 8px rgba(0,0,0,0.1);">

  <input type="hidden" name="studentId" th:value="${student.id}">
  <input type="hidden" name="date" th:value="${today}">
  <input type="hidden" name="name" th:value="${student.name}">
  <input type="hidden" name="course" th:value="${student.course.name}">

  <input type="hidden" id="statusField" name="status" value="Absent">

  <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
    <label for="reason" style="font-size:15px; font-weight:600; color:#333;">Reason:</label>
    <input type="text" id="reason" placeholder="Enter reason here..."
           style="
             flex:1;
             min-width:220px;
             padding:10px 14px;
             border:1px solid #ccc;
             border-radius:6px;
             font-size:14px;
             outline:none;
             transition:border-color 0.3s;
           "
           onfocus="this.style.borderColor='#007bff'"
           onblur="this.style.borderColor='#ccc'"
           oninput="document.getElementById('statusField').value='Absent - Reason: ' + this.value;">
  </div>

  <div style="margin-top:18px; display:flex; gap:12px;">
    <button type="submit"
            style="
              padding:10px 20px;
              border:none;
              border-radius:6px;
              background:linear-gradient(45deg,#f44336,#e53935);
              color:white;
              font-size:14px;
              font-weight:600;
              cursor:pointer;
              transition:all 0.3s ease;
              box-shadow:0 3px 6px rgba(0,0,0,0.15);
            "
            onmouseover="this.style.opacity=0.9"
            onmouseout="this.style.opacity=1">
      Save as Absent
    </button>

    <button type="button"
            onclick="cancelReasonBox();"
            style="
              padding:10px 20px;
              border:1px solid #bbb;
              border-radius:6px;
              background:#fff;
              color:#333;
              font-size:14px;
              font-weight:600;
              cursor:pointer;
              transition:all 0.3s ease;
            "
            onmouseover="this.style.background='#f0f0f0'"
            onmouseout="this.style.background='#fff'">
      Cancel
    </button>
  </div>
</form>

<script>
  function showReasonBox() {
    document.getElementById("reason-box").style.display = "block";
    document.getElementById("absentBtn").style.display = "none";
  }

  function cancelReasonBox() {
    document.getElementById("reason-box").style.display = "none";
    document.getElementById("absentBtn").style.display = "inline-block";
  }
</script>


</div>


    <div th:unless="${canMark}" style="color:red; margin-top:15px; font-size:14px;">
      Attendance is not open or time limit expired.
    </div>

  </div>
</div>

  </main>
</div>

<footer>
  <div class="footer-container">
    <div class="footer-section">
      <h4>College ERP System</h4>
      <p>&copy; 2025 All Rights Reserved</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="/student-management">Student Management</a></li>

        <li><a href="/attendence">Attendance</a></li>
        <li><a href="/reports">Reports</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Contact</h4>
      <p>Email: support@collegeerp.com</p>
      <p>Phone: +91-9876543210</p>
    </div>
  </div>
</footer>
</body>
</html>
